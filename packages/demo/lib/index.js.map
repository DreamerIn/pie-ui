{"version":3,"sources":["../src/index.js"],"names":["express","require","port","resolve","dirname","webpack","middleware","fs","publicPath","buildApp","config","app","console","log","compiler","use","set","get","req","res","send","name","params","data","__dirname","render","e","status","end","writeEntry","pkg","js","outPath","mkdirpSync","writeFileSync","buildWebpackConfig","packages","Object","keys","dependencies","filter","p","startsWith","map","replace","entry","reduce","cfg","Promise","context","output","run","listen","catch","error"],"mappings":"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","file":"index.js","sourcesContent":["const express = require('express');\nconst port = 3000;\nconst { resolve, dirname } = require('path');\nconst webpack = require('webpack');\nconst middleware = require('webpack-dev-middleware');\nconst fs = require('fs-extra');\n\nconst publicPath = '/assets';\n\nconst buildApp = config => {\n  const app = express();\n\n  console.log('config:', config);\n  const compiler = webpack(config);\n\n  app.use(\n    middleware(compiler, {\n      // webpack-dev-middleware options\n      publicPath\n    })\n  );\n\n  app.set('view engine', 'pug');\n\n  app.get('/', (req, res) => {\n    res.send('hi');\n  });\n\n  app.get('/:name', (req, res) => {\n    const name = req.params.name;\n\n    console.log('name:', name);\n\n    try {\n      const data = require(resolve(\n        __dirname,\n        '../../../packages',\n        name,\n        'demo/config'\n      ));\n      res.render('package-demo', { name: 'calculator', data });\n    } catch (e) {\n      res.status(500).end();\n    }\n  });\n  return app;\n};\n\nconst writeEntry = pkg => {\n  const js = `\n    import Element from '@pie-ui/${pkg}';\n    customElements.define('${pkg}-el', Element); \n  `;\n  const outPath = resolve(__dirname, '..', '.out', `${pkg}.js`);\n  fs.mkdirpSync(dirname(outPath));\n  fs.writeFileSync(resolve(__dirname, '..', '.out', `${pkg}.js`), js, 'utf8');\n};\n\nconst buildWebpackConfig = () => {\n  const pkg = require(resolve(__dirname, '../package.json'));\n  const packages = Object.keys(pkg.dependencies)\n    .filter(p => p.startsWith('@pie-ui'))\n    .map(p => p.replace('@pie-ui/', ''));\n\n  console.log('packages', packages);\n\n  const entry = packages.reduce((cfg, p) => {\n    writeEntry(p);\n    cfg[p] = `./${p}.js`;\n    return cfg;\n  }, {});\n\n  return Promise.resolve({\n    entry,\n    context: resolve(__dirname, '..', '.out'),\n    output: {\n      publicPath\n    }\n  });\n};\n\nconst run = async () => {\n  const config = await buildWebpackConfig();\n  const app = buildApp(config);\n\n  app.listen(port, () => console.log(`Example app listening on port ${port}!`));\n};\n\nrun().catch(e => {\n  console.error(e);\n});\n"]}